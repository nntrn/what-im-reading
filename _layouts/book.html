---
layout: default
inline_css: ["book.css"]
---
{%- assign pagecreated = page.created | date_to_string: "ordinal", "US" -%}
{%- assign pagemodified = page.modified |  date_to_string: "ordinal", "US" -%}
{%- assign api = site.data.store | where: 'id', page.assetid |first -%}
{%- assign annotations = site.data.activity | where: 'assetid', page.assetid  | sort: "cfi" -%}

<div class="container">
  <div class="page-content pt-0 mt-1 pb-2 sm-px-0">
    <h2 class="book-title">{{ page.title }}</h2>
    <h3 class="book-subtitle">{{ api.subtitle}}</h3>
    <h3 class="book-author">{{page.author}}</h3>
    <p class="info">
      {{annotations.size}} annotation{% if annotations.size > 1 %}s{%- endif %} &bull; 
      <a class="dotted" href="{{site.baseurl}}/api/{{page.assetid}}.json">data</a>
    </p>
    <p class="info">
      <span>First annotation on <strong><time datetime="{{page.date}}">{{pagecreated}}</time></strong>.</span>
      {%- if pagemodified != pagecreated %}
      <span>Last on <strong><time datetime="{{page.modified}}">{{pagemodified}}</time></strong>.</span>
      {%- endif -%}
    </p>
    <div class="tag-list mt-1">
      {%- for tag in page.tags -%}
      <a href="{{ site.baseurl }}/{{tag}}" class="tag fs-90 gc">{{ tag }}</a>
      {%- endfor -%}
    </div>
    <hr>
    <section class="reader">
    {%- assign chapters = annotations | group_by: "chapter" -%}
    {%- for chapter in chapters -%}
    {%- assign sortedchapteritems = chapter.items | sort: "cfi" %}
    <h3 class="chapter-title">{{chapter.name}}</h3>
    <ul class="annotation-list" style="--gap:5px">
      {%- for annotation in sortedchapteritems %}
      <li id="{{annotation.id}}" class="bookmark">
        <span class="q">{{ annotation.text }}</span>
        <small class="timestamp" aria-hidden="true">
          <a href="#{{annotation.id}}">#{{annotation.id}}</a>
          <span class="accent">&bull;</span>
          <time>{{annotation.created|date:'%b %-d %Y %-I:%M%p'}}</time>
        </small>
      </li>
      {%- endfor %}
    </ul>
    {%- endfor %}
    </section>
  </div>
  <div class="sidebar pt-0 mt-1 pr-0 px-1">
    <div class="separator">
    {%- include postlist.html -%}
    </div>
  </div>
</div>
<script>
  function highlightAnnotation() {
    Array.from(document.querySelectorAll('.highlighted')).forEach(e => e.classList.remove('highlighted'))
    if (location.hash) {
      document.querySelector(`[id="${location.hash.substr(1)}"]`).classList.add('highlighted')
    }
  }
  highlightAnnotation()
  window.onhashchange = highlightAnnotation;
</script>
