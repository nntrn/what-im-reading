---
layout: default
---
{%- assign pagecreated = page.created | date_to_string: "ordinal", "US" -%}
{%- assign pagemodified = page.modified |  date_to_string: "ordinal", "US" -%}
{%- assign api = site.data.store | where: 'id', page.assetid |first -%}
{%- assign annotations = site.data.activity | where: 'assetid', page.assetid  | sort: "cfi" -%}
<style>
.page-content li{all:unset}
q{white-space:pre-line;display:block;word-break:break-word}
.annotation-list li{display:list-item}
.annotation-list q{white-space:pre-line}
.annotation-list{display:flex;flex-direction:column;gap:1rem}
.highlighted q:after{content:"";display:block}
.highlighted q{background:hsl(60,100%,83.5%);display:inline;line-height:1.3}
.post-list li a{line-height:1.5;transition:text-decoration .2s}
.post-list li a:hover{text-decoration-color:#222;text-underline-offset:1px;transition:text-decoration .2s}
.timestamp a:hover{font-weight:700}
.timestamp a{background:unset;text-decoration:none;font-weight:400}
.timestamp{display:block;margin-top:2px}
@media (max-width:700px){
.page-content{padding-left:1rem;padding-right:1rem}
}
@media (min-width:700px){
.highlighted{max-width:50vw!important}
.highlighted q{line-height:1.5}
}
</style>
<div class="container">
  <div class="page-content pt-0 mt-1 pb-2 sm-px-0">
    <h2 class="book-title">{{ page.title }}</h2>
    <h3 class="book-subtitle">{{ api.subtitle}}</h3>
    <h3 class="book-author">{{page.author}}</h3>
    <p class="info">
      <span>First annotation on <time datetime="{{page.date}}">{{pagecreated}}</time>.</span>
      {%- if pagemodified != pagecreated %}
      <span>Last on <time datetime="{{page.modified}}">{{pagemodified}}</time>.</span>
      {%- endif -%}
    </p>
    <p><span class="fs-90 up muted">{{annotations.size}} quote{%- if annotations.size > 1 -%}s{%- endif -%}</span></p>
    <div class="tag-list mt-1">
      {%- for tag in page.tags -%}
      <a href="{{ site.baseurl }}/{{tag}}" class="tag fs-90 gc">{{ tag }}</a>
      {%- endfor -%}
    </div>
    <hr>
    {%- assign chapters = annotations | group_by: "chapter" -%}
    {%- for chapter in chapters -%}
    {%- assign sortedchapteritems = chapter.items | sort: "cfi" %}
    <h3 class="chapter-title">{{chapter.name}}</h3>
    <ul class="annotation-list" style="--gap:5px">
      {%- for annotation in sortedchapteritems %}
      <li id="{{annotation.id}}" class="bookmark">
        <q>{{ annotation.text }}</q>
        <small class="timestamp flex gap" aria-hidden="true">
          <a href="#{{annotation.id}}">#{{annotation.id}}</a>
          <span class="accent">&bull;</span>
          <time>{{annotation.created|date:'%b %-d %Y %-I:%M%p'}}</time>
        </small>
      </li>
      {%- endfor %}
    </ul>
    {%- endfor %}
  </div>
  <div class="sidebar pt-0 mt-1 pr-0">
    <div class="separator">
    {%- include postlist.html -%}
    </div>
  </div>
</div>
<script>
  function highlightAnnotation() {
    Array.from(document.querySelectorAll('.highlighted')).forEach(e => e.classList.remove('highlighted'))
    if (location.hash) {
      document.querySelector(`[id="${location.hash.substr(1)}"]`).classList.add('highlighted')
    }
  }
  highlightAnnotation()
  window.onhashchange = highlightAnnotation;
</script>
